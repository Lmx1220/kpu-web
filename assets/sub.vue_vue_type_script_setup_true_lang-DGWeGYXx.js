
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as S,aZ as w,aD as _,c as p,L as I,o as d,b as m,j as x,f as s,h,w as H,n as $,F as y,m as E,i as g,Z as F,bu as A,T as L,aT as N,K as k,aU as O,aw as W}from"./index-putfknEa.js";import{I as j,r as J}from"./item-BttuOdLs.js";const Z=S({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(R){const n=R,c=n.menu.path??JSON.stringify(n.menu),v=w("itemRef"),M=w("subMenuRef"),t=_(J),C=p(()=>t.openedMenus.includes(n.uniqueKey.at(-1))),b=p(()=>t.alwaysOpenedsMenus.includes(n.uniqueKey.at(-1))),q=p(()=>t.isMenuPopup?{enter(e){e.offsetHeight>window.innerHeight&&(e.style.height=`${window.innerHeight}px`)},afterEnter:()=>{},beforeLeave:e=>{e.style.maxHeight=`${e.offsetHeight}px`,e.style.overflow="hidden"},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""}}:{enter(e){requestAnimationFrame(()=>{e.dataset.height=e.offsetHeight.toString(),e.style.maxHeight="0",e.offsetHeight,e.style.maxHeight=`${e.dataset.height}px`,e.style.overflow="hidden"})},afterEnter(e){e.style.maxHeight="",e.style.overflow=""},enterCancelled(e){e.style.maxHeight="",e.style.overflow=""},beforeLeave(e){e.style.maxHeight=`${e.offsetHeight}px`,e.style.overflow="hidden"},leave(e){e.style.maxHeight="0"},afterLeave(e){e.style.maxHeight="",e.style.overflow=""},leaveCancelled(e){e.style.maxHeight="",e.style.overflow=""}}),P=p(()=>t.isMenuPopup?{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}:{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-y-4 scale-95 blur-4",enterToClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveToClass:"opacity-0 translate-y-4 scale-95 blur-4"}),r=p(()=>{let e=!0;return n.menu.children?n.menu.children.every(a=>{var i;return((i=a.meta)==null?void 0:i.menu)===!1})&&(e=!1):e=!1,e});function K(){b.value||t.isMenuPopup&&r.value||(r.value?t.handleSubMenuClick(c,n.uniqueKey):t.handleMenuItemClick(c))}let l;function B(){t.isMenuPopup&&(t.mouseInMenu=n.uniqueKey,l==null||l(),{stop:l}=k(()=>{if(r.value)t.openMenu(c,n.uniqueKey),W(()=>{var u,f;const e=(u=v.value)==null?void 0:u.ref,a=(f=M.value)==null?void 0:f.$el;if(!e||!a)return;let i=0,o=0;t.props.mode==="vertical"||n.level!==0?(i=e.getBoundingClientRect().top+e.scrollTop,o=(t.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)+e.getBoundingClientRect().width,i+a.offsetHeight>window.innerHeight&&(i=window.innerHeight-a.offsetHeight)):(i=e.getBoundingClientRect().top+e.getBoundingClientRect().height,o=t.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right,i+a.offsetHeight>window.innerHeight&&(a.style.height=`${window.innerHeight-i}px`)),o+a.offsetWidth>document.documentElement.clientWidth&&(o=e.getBoundingClientRect().left-e.getBoundingClientRect().width),a.style.top=`${i}px`,a.style.insetInlineStart=`${o}px`});else{const e=n.menu.children?t.subMenus[c].indexPath.at(-1):t.items[c].indexPath.at(-1);t.openMenu(e,t.subMenus[e].indexPath)}},300))}function T(){t.isMenuPopup&&(t.mouseInMenu=[],l==null||l(),{stop:l}=k(()=>{t.mouseInMenu.length===0?t.closeMenu(n.uniqueKey):r.value&&!t.mouseInMenu.includes(n.uniqueKey.at(-1))&&t.closeMenu(n.uniqueKey.at(-1))},300))}return(e,a)=>{const i=I("SubMenu"),o=O;return d(),m(y,null,[x(j,{ref_key:"itemRef",ref:v,"unique-key":e.uniqueKey,item:e.menu,level:e.level,"sub-menu":s(r),expand:s(C),"always-expand":s(b),onClick:K,onMouseenter:B,onMouseleave:T},null,8,["unique-key","item","level","sub-menu","expand","always-expand"]),s(r)?(d(),h(N,{key:0,to:"body",disabled:!s(t).isMenuPopup},[x(L,F(s(P),A(s(q))),{default:H(()=>[s(C)?(d(),h(o,{key:0,ref_key:"subMenuRef",ref:M,scrollbar:!1,mask:s(t).isMenuPopup,class:$(["sub-menu static rounded-lg",{"bg-[var(--g-sub-sidebar-bg)]":s(t).isMenuPopup,"border shadow-xl fixed! z-3000 w-[200px]":s(t).isMenuPopup,"mx-1":s(t).isMenuPopup&&(s(t).props.mode==="vertical"||e.level!==0),"py-1":s(t).isMenuPopup}])},{default:H(()=>[(d(!0),m(y,null,E(e.menu.children,u=>{var f;return d(),m(y,{key:u.path??JSON.stringify(u)},[((f=u.meta)==null?void 0:f.menu)!==!1?(d(),h(i,{key:0,"unique-key":[...e.uniqueKey,u.path??JSON.stringify(u)],menu:u,level:e.level+1},null,8,["unique-key","menu","level"])):g("",!0)],64)}),128))]),_:1},8,["mask","class"])):g("",!0)]),_:1},16)],8,["disabled"])):g("",!0)],64)}}});export{Z as _};
