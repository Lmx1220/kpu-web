
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
var ze=Object.defineProperty;var He=(e,t,n)=>t in e?ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var E=(e,t,n)=>He(e,typeof t!="symbol"?t+"":t,n);import{d as T,c as y,o as w,f as _,w as C,t as V,A as I,e as u,B as A,bG as We,n as Z,ag as ve,p as Ne,W as Ke,bH as Ye,bI as Ge,bJ as Qe,bK as se,bL as M,bM as he,bN as $e,bO as Je,bP as ye,bQ as Xe,bR as et,a4 as tt,a5 as De,a as x,M as ue,N as J,b as me,i as U,m as nt,bS as Te,L as st,bT as K,bU as ot,P as oe,bV as at,F as be,af as ce,h as k,q as Le,r as z,bW as Se,bX as rt,aN as je,a9 as ge,U as lt,v as H,y as W,b0 as Ze,l as _e,T as it,V as ut,bY as ct,bZ as dt,aa as xe,b_ as mt,b$ as ft,a_ as pt,aY as ht,c0 as vt,c1 as bt,aj as gt,$ as Ee}from"./bootstrap-CKvMAU9X.js";import{_ as yt}from"./index.vue_vue_type_script_setup_true_lang-CNtKwcVN.js";import{_ as wt}from"./index.vue_vue_type_script_setup_true_lang-CsmDEr-2.js";import{_ as Ct}from"./index.vue_vue_type_script_setup_true_lang-B6tbNkyL.js";import{d as Ft,e as St,z as F,u as Rt,o as Vt,f as qe,g as Ot,t as Pt,_ as _t,a as Bt,c as kt,F as Mt,h as Nt}from"./vee-validate-zod-BNmr89XN.js";import{_ as $t}from"./FormDescription.vue_vue_type_script_setup_true_lang-B4OHZ_Ln.js";class Et{constructor(){E(this,"condition",!1);E(this,"rejectCondition",null);E(this,"resolveCondition",null)}isConditionTrue(){return this.condition}reset(){this.condition=!1,this.clearPromises()}setConditionFalse(){this.condition=!1,this.rejectCondition&&(this.rejectCondition(),this.clearPromises())}setConditionTrue(){this.condition=!0,this.resolveCondition&&(this.resolveCondition(),this.clearPromises())}waitForCondition(){return new Promise((t,n)=>{this.condition?t():(this.resolveCondition=t,this.rejectCondition=n)})}clearPromises(){this.resolveCondition=null,this.rejectCondition=null}}const It=T({__name:"Label",props:{for:{},asChild:{type:Boolean},as:{},class:{}},setup(e){const t=e,n=y(()=>{const{class:s,...r}=t;return r});return(s,r)=>(w(),_(u(We),I(n.value,{class:u(A)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70",t.class)}),{default:C(()=>[V(s.$slots,"default")]),_:3},16,["class"]))}}),At=T({__name:"FormLabel",props:{for:{},asChild:{type:Boolean},as:{},class:{}},setup(e){const t=e,{error:n,formItemId:s}=Ft();return(r,l)=>(w(),_(u(It),{class:Z(u(A)(u(n)&&"text-destructive",t.class)),for:u(s)},{default:C(()=>[V(r.$slots,"default")]),_:3},8,["class","for"]))}}),Ie="modelValue",Ue={},de={DefaultButton:ve(Ne,{size:"sm",variant:"outline"}),PrimaryButton:ve(Ne,{size:"sm",variant:"default"}),KpuCheckbox:yt,KpuInput:Ke,KpuPinInput:wt,KpuSelect:Ct},Ve={KCheckbox:"checked"};function Dt(e){const{config:t,defineRules:n}=e,{disabledOnChangeListener:s=!0,disabledOnInputListener:r=!0,emptyStateValue:l=void 0}=t||{};if(Object.assign(Ue,{disabledOnChangeListener:s,disabledOnInputListener:r,emptyStateValue:l}),n)for(const d of Object.keys(n))St(d,n[d]);const c=(t==null?void 0:t.baseModelPropName)??Ie,o=t==null?void 0:t.modelPropNameMap,i=Ye.getComponents();for(const d of Object.keys(i)){const m=d;de[m]=i[d],c!==Ie&&(Ve[m]=c),o&&o[m]&&(Ve[m]=o[m])}}function Tt(){return{actionWrapperClass:"",collapsed:!1,collapsedRows:1,collapseTriggerResize:!1,commonConfig:{},handleReset:void 0,handleSubmit:void 0,handleValuesChange:void 0,layout:"horizontal",resetButtonOptions:{},schema:[],showCollapseButton:!1,showDefaultActions:!0,submitButtonOptions:{},submitOnChange:!1,submitOnEnter:!1,wrapperClass:"grid-cols-1"}}class Lt{constructor(t={}){E(this,"form",{});E(this,"isMounted",!1);E(this,"state",null);E(this,"stateHandler");E(this,"store");E(this,"latestSubmissionValues",null);E(this,"prevState",null);E(this,"handleRangeTimeValue",t=>{var r;const n={...t},s=(r=this.state)==null?void 0:r.fieldMappingTime;return!s||!Array.isArray(s)||s.forEach(([l,[c,o],i="YYYY-MM-DD"])=>{if(c&&o&&n[l]===null&&(Reflect.deleteProperty(n,c),Reflect.deleteProperty(n,o)),!n[l]){Reflect.deleteProperty(n,l);return}const[d,m]=n[l];if(i===null)n[c]=d,n[o]=m;else if(M(i))n[c]=i(d,c),n[o]=i(m,o);else{const[h,v]=Array.isArray(i)?i:[i,i];n[c]=d?$e(d,h):void 0,n[o]=m?$e(m,v):void 0}Reflect.deleteProperty(n,l)}),n});const{...n}=t,s=Tt();this.store=new Ge({...s,...n},{onUpdate:()=>{this.prevState=this.state,this.state=this.store.state,this.updateState()}}),this.state=this.store.state,this.stateHandler=new Et,Qe(this)}getLatestSubmissionValues(){return this.latestSubmissionValues||{}}getState(){return this.state}async getValues(){const t=await this.getForm();return t.values?this.handleRangeTimeValue(t.values):{}}async isFieldValid(t){return(await this.getForm()).isFieldValid(t)}merge(t){const n=[this,t],s=new Proxy(t,{get(r,l){return l==="merge"?c=>(n.push(c),s):l==="submitAllForm"?async(c=!0)=>{try{const o=await Promise.all(n.map(async i=>(await i.validate()).valid?se(await i.getValues()||{}):void 0));return c?Object.assign({},...o):o}catch(o){console.error("Validation error:",o)}}:r[l]}});return s}mount(t){this.isMounted||(Object.assign(this.form,t),this.stateHandler.setConditionTrue(),this.setLatestSubmissionValues({...se(this.handleRangeTimeValue(this.form.values))}),this.isMounted=!0)}async removeSchemaByFields(t){var l;const n=new Set(t),r=(((l=this.state)==null?void 0:l.schema)??[]).filter(c=>!n.has(c.fieldName));this.setState({schema:r})}async resetForm(t,n){return(await this.getForm()).resetForm(t,n)}async resetValidate(){const t=await this.getForm();Object.keys(t.errors.value).forEach(s=>{t.setFieldError(s,void 0)})}async setFieldValue(t,n,s){(await this.getForm()).setFieldValue(t,n,s)}setLatestSubmissionValues(t){this.latestSubmissionValues={...se(t)}}setState(t){M(t)?this.store.setState(n=>he(t(n),n)):this.store.setState(n=>he(t,n))}async setValues(t,n=!0,s=!1){const r=await this.getForm();if(!n){r.setValues(t,s);return}const l=Je((o,i,d)=>(i in o&&(o[i]=!Array.isArray(o[i])&&ye(o[i])&&!Xe(o[i])&&!et(o[i])?l(o[i],d):d),!0)),c=l(t,r.values);r.setValues(c,s)}async submitForm(t){var r,l;t==null||t.preventDefault(),t==null||t.stopPropagation(),await(await this.getForm()).submitForm();const s=se(await this.getValues());return await((l=(r=this.state)==null?void 0:r.handleSubmit)==null?void 0:l.call(r,s)),s}unmount(){var t,n;(n=(t=this.form)==null?void 0:t.resetForm)==null||n.call(t),this.latestSubmissionValues=null,this.isMounted=!1,this.stateHandler.reset()}updateSchema(t){var c;const n=[...t];if(!n.every(o=>Reflect.has(o,"fieldName")&&o.fieldName)){console.error("All items in the schema array must have a valid `fieldName` property to be updated");return}const r=[...((c=this.state)==null?void 0:c.schema)??[]],l={};n.forEach(o=>{o.fieldName&&(l[o.fieldName]=o)}),r.forEach((o,i)=>{const d=l[o.fieldName];d&&(r[i]=he(d,o))}),this.setState({schema:r})}async validate(t){const s=await(await this.getForm()).validate(t);return Object.keys((s==null?void 0:s.errors)??{}).length>0&&console.error("validate error",s==null?void 0:s.errors),s}async validateAndSubmitForm(){const t=await this.getForm(),{valid:n}=await t.validate();if(n)return await this.submitForm()}async validateField(t,n){const r=await(await this.getForm()).validateField(t,n);return Object.keys((r==null?void 0:r.errors)??{}).length>0&&console.error("validate error",r==null?void 0:r.errors),r}async getForm(){var t;if(this.isMounted||await this.stateHandler.waitForCondition(),!((t=this.form)!=null&&t.meta))throw new Error("<KpuForm /> is not mounted");return this.form}updateState(){var s,r,l,c;const t=((s=this.state)==null?void 0:s.schema)??[],n=((r=this.prevState)==null?void 0:r.schema)??[];if(t.length<n.length){const o=new Set(t.map(d=>d.fieldName)),i=n.filter(d=>!o.has(d.fieldName));for(const d of i)(c=(l=this.form)==null?void 0:l.setFieldValue)==null||c.call(l,d.fieldName,void 0)}}}const jt=T({__name:"index",props:tt({class:{}},{modelValue:{default:!1},modelModifiers:{}}),emits:["update:modelValue"],setup(e){const t=e,n=De(e,"modelValue");return(s,r)=>{const l=nt;return w(),x("div",{class:Z(u(A)("cursor-pointer color-primary inline-flex items-center",t.class)),onClick:r[0]||(r[0]=c=>n.value=!n.value)},[V(s.$slots,"default",{isExpanded:n.value},()=>[ue(J(n.value),1)]),me("div",{class:Z([{"rotate-180":!n.value},"transition-transform duration-300"])},[V(s.$slots,"icon",{},()=>[U(l,{name:"i-lucide:chevron-down",class:"size-4"})])],2)],2)}}}),Q=(e,t)=>e.constructor.name===t.name,P=new Map;P.set(F.ZodBoolean.name,()=>!1),P.set(F.ZodNumber.name,()=>0),P.set(F.ZodString.name,()=>""),P.set(F.ZodArray.name,()=>[]),P.set(F.ZodRecord.name,()=>({})),P.set(F.ZodDefault.name,e=>e._def.defaultValue()),P.set(F.ZodEffects.name,e=>ie(e._def.schema)),P.set(F.ZodOptional.name,e=>Q(e._def.innerType,F.ZodDefault)?e._def.innerType._def.defaultValue():void 0),P.set(F.ZodTuple.name,e=>{const t=[];for(const n of e._def.items)t.push(ie(n));return t}),P.set(F.ZodEffects.name,e=>ie(e._def.schema)),P.set(F.ZodUnion.name,e=>ie(e._def.options[0])),P.set(F.ZodObject.name,e=>Y(e)),P.set(F.ZodRecord.name,e=>Y(e)),P.set(F.ZodIntersection.name,e=>Y(e));function ie(e){const t=e.constructor.name;if(!P.has(t)){console.warn("getSchemaDefaultForField: Unhandled type",e.constructor.name);return}return P.get(t)(e)}function Y(e){if(Q(e,F.ZodRecord))return{};if(Q(e,F.ZodEffects))return Y(e._def.schema);if(Q(e,F.ZodIntersection))return{...Y(e._def.left),...Y(e._def.right)};if(Q(e,F.ZodUnion)){for(const t of e._def.options)if(Q(t,F.ZodObject))return Y(t);return console.warn("getSchemaDefaultObject: No object found in union, returning empty object"),{}}return Q(e,F.ZodObject)?Object.fromEntries(Object.entries(e.shape).map(([t,n])=>[t,ie(n)]).filter(t=>t[1]!==void 0)):(console.warn(`getSchemaDefaultObject: Expected object schema, got ${e.constructor.name}`),{})}function Zt(e){return Y(e)}const[xt,qt]=Te("KpuFormProps");function Ut(e){var c;const t=st(),n=l(),s=Rt({...(c=Object.keys(n))!=null&&c.length?{initialValues:n}:{}}),r=y(()=>{const o=[];for(const i of Object.keys(t))i!=="default"&&o.push(i);return o});function l(){const o={},i={};(u(e).schema||[]).forEach(m=>{Reflect.has(m,"defaultValue")?o[m.fieldName]=m.defaultValue:m.rules&&!K(m.rules)&&(i[m.fieldName]=m.rules)});const d=Zt(Vt(i));return{...o,...d}}return{delegatedSlots:r,form:s}}const zt=T({__name:"form-actions",props:{modelValue:{default:!1},modelModifiers:{}},emits:["update:modelValue"],setup(e,{expose:t}){const{$t:n}=ot(),[s,r]=xt(),l=De(e,"modelValue"),c=y(()=>({content:`${n.value("reset")}`,show:!0,...u(s).resetButtonOptions})),o=y(()=>({content:`${n.value("submit")}`,show:!0,...u(s).submitButtonOptions})),i=y(()=>u(s).actionWrapperClass?{}:{"grid-column":"-2 / -1",marginLeft:"auto"});async function d(h){var p,b,g;h==null||h.preventDefault(),h==null||h.stopPropagation();const{valid:v}=await r.validate();if(!v)return;const f=se(await((p=u(s).formApi)==null?void 0:p.getValues()));await((g=(b=u(s)).handleSubmit)==null?void 0:g.call(b,f))}async function m(h){var p,b;h==null||h.preventDefault(),h==null||h.stopPropagation();const v=u(s),f=se((p=v.formApi)==null?void 0:p.getValues());M(v.handleReset)?await((b=v.handleReset)==null?void 0:b.call(v,f)):r.resetForm()}return oe(()=>l.value,()=>{u(s).collapseTriggerResize&&at()}),t({handleReset:m,handleSubmit:d}),(h,v)=>{const f=jt;return w(),x("div",{class:Z(u(A)("col-span-full w-full text-right",u(s).compact?"pb-2":"pb-6",u(s).actionWrapperClass)),style:Le(i.value)},[u(s).actionButtonsReverse?(w(),x(be,{key:0},[V(h.$slots,"submit-before"),o.value.show?(w(),_(ce(u(de).PrimaryButton),I({key:0,class:"ml-3",type:"button"},o.value,{onClick:d}),{default:C(()=>[ue(J(o.value.content),1)]),_:1},16)):k("",!0)],64)):k("",!0),V(h.$slots,"reset-before"),c.value.show?(w(),_(ce(u(de).DefaultButton),I({key:1,class:"ml-3",type:"button"},c.value,{onClick:m}),{default:C(()=>[ue(J(c.value.content),1)]),_:1},16)):k("",!0),u(s).actionButtonsReverse?k("",!0):(w(),x(be,{key:2},[V(h.$slots,"submit-before"),o.value.show?(w(),_(ce(u(de).PrimaryButton),I({key:0,class:"ml-3",type:"button"},o.value,{onClick:d}),{default:C(()=>[ue(J(o.value.content),1)]),_:1},16)):k("",!0)],64)),V(h.$slots,"expand-before"),u(s).showCollapseButton?(w(),_(f,{key:3,"model-value":l.value,"onUpdate:modelValue":v[0]||(v[0]=p=>l.value=p),class:"ml-2"},{default:C(()=>[me("span",null,J(l.value?u(n)("expand"):u(n)("collapse")),1)]),_:1},8,["model-value"])):k("",!0),V(h.$slots,"expand-after")],6)}}}),Re=T({name:"RenderContent",props:{content:{default:void 0,type:[Object,String,Function]}},setup(e,{attrs:t,slots:n}){return()=>e.content?(ye(e.content)||M(e.content))&&e.content!==null?ve(e.content,{...t,props:{...e,...t},slots:n}):e.content:null}}),[Be,Ht]=Te("FormRenderProps");function Wt(){const e=Be(),t=y(()=>e.layout==="vertical"),n=y(()=>e.componentMap);return{componentBindEventMap:y(()=>e.componentBindEventMap),componentMap:n,isVertical:t}}function Kt(e){const t=qe(),s=Be().form;if(!t)throw new Error("useDependencies should be used within <KpuForm>");const r=z(!0),l=z(!1),c=z(!0),o=z(!1),i=z({}),d=z(),m=y(()=>{var f;return(((f=e())==null?void 0:f.triggerFields)??[]).map(p=>t.value[p])}),h=()=>{l.value=!1,r.value=!0,c.value=!0,o.value=!1,d.value=void 0,i.value={}};return oe([m,e],async([v,f])=>{var X;if(!f||!((X=f==null?void 0:f.triggerFields)!=null&&X.length))return;h();const{componentProps:p,disabled:b,if:g,required:N,rules:D,show:S,trigger:G}=f,$=t.value;if(M(g)){if(r.value=!!await g($,s),!r.value)return}else if(Se(g)&&(r.value=g,!r.value))return;if(M(S)){if(c.value=!!await S($,s),!c.value)return}else if(Se(S)&&(c.value=S,!c.value))return;M(p)&&(i.value=await p($,s)),M(D)&&(d.value=await D($,s)),M(b)?l.value=!!await b($,s):Se(b)&&(l.value=b),M(N)&&(o.value=!!await N($,s)),M(G)&&await G($,s)},{deep:!0,immediate:!0}),{dynamicComponentProps:i,dynamicRules:d,isDisabled:l,isIf:r,isRequired:o,isShow:c}}const Yt={key:0,class:"mr-[2px] text-destructive"},Gt=T({__name:"form-label",props:{class:{},help:{},required:{type:Boolean}},setup(e){const t=e;return(n,s)=>(w(),_(u(At),{class:Z(u(A)("flex items-center",t.class))},{default:C(()=>[n.required?(w(),x("span",Yt,"*")):k("",!0),V(n.$slots,"default"),n.help?(w(),_(rt,{key:1,"trigger-class":"size-3.5 ml-1"},{default:C(()=>[ue(J(n.help),1)]),_:1})):k("",!0)]),_:3},8,["class"]))}});function Oe(e){return!e||K(e)?null:"innerType"in e._def?Oe(e._def.innerType):"schema"in e._def?Oe(e._def.schema):e}function Pe(e){if(!e||K(e))return;const t=e;if(t._def.typeName==="ZodDefault")return t._def.defaultValue();if("innerType"in t._def)return Pe(t._def.innerType);if("schema"in t._def)return Pe(t._def.schema)}function Ae(e){return!e||!ye(e)?!1:Reflect.has(e,"target")&&Reflect.has(e,"stopPropagation")}const Qt={key:0,class:"ml-[2px]"},Jt={key:0,class:"ml-1"},Xt=T({__name:"form-field",props:{component:{},componentProps:{type:Function},defaultValue:{},dependencies:{},description:{},fieldName:{},help:{},label:{},renderComponentContent:{type:Function},rules:{},suffix:{type:[Function,String]},colon:{type:Boolean},controlClass:{},disabled:{type:Boolean},disabledOnChangeListener:{type:Boolean},disabledOnInputListener:{type:Boolean},emptyStateValue:{},formFieldProps:{},formItemClass:{},hideLabel:{type:Boolean},hideRequiredMark:{type:Boolean},labelClass:{},labelWidth:{},modelPropName:{},wrapperClass:{},commonComponentProps:{}},setup(e){const{componentBindEventMap:t,componentMap:n,isVertical:s}=Wt(),r=Be(),l=qe(),c=Ot(e.fieldName),o=je("fieldComponentRef"),i=r.form,d=r.compact,m=y(()=>{var a;return((a=c.value)==null?void 0:a.length)>0}),h=y(()=>{const a=K(e.component)?n.value[e.component]:e.component;return a||console.warn(`Component ${e.component} is not registered`),a}),{dynamicComponentProps:v,dynamicRules:f,isDisabled:p,isIf:b,isRequired:g,isShow:N}=Kt(()=>e.dependencies),D=y(()=>{var a;return(a=e.labelClass)!=null&&a.includes("w-")||s.value?{}:{width:`${e.labelWidth}px`}}),S=y(()=>f.value||e.rules),G=y(()=>b.value&&N.value),$=y(()=>{var B,O,ee,re,le,j;if(!G.value)return!1;if(!S.value)return g.value;if(g.value)return!0;if(K(S.value))return["required","selectRequired"].includes(S.value);let a=(O=(B=S==null?void 0:S.value)==null?void 0:B.isOptional)==null?void 0:O.call(B);if(((re=(ee=S==null?void 0:S.value)==null?void 0:ee._def)==null?void 0:re.typeName)==="ZodDefault"){const te=(le=S==null?void 0:S.value)==null?void 0:le._def.innerType;te&&(a=(j=te.isOptional)==null?void 0:j.call(te))}return!a}),X=y(()=>{var B;if(!G.value)return null;let a=S.value;if(!a)return g.value?"required":null;if(K(a))return a;if(!!$.value){const O=(B=a==null?void 0:a.unwrap)==null?void 0:B.call(a);O&&(a=O)}return Pt(a)}),L=y(()=>{const a=M(e.componentProps)?e.componentProps(l.value,i):e.componentProps;return{...e.commonComponentProps,...a,...v.value}});oe(()=>{var a;return(a=L.value)==null?void 0:a.autofocus},a=>{a===!0&&ge(()=>{Fe()})},{immediate:!0});const fe=y(()=>{var a;return p.value||e.disabled||((a=L.value)==null?void 0:a.disabled)}),pe=y(()=>M(e.renderComponentContent)?e.renderComponentContent(l.value,i):{}),we=y(()=>Object.keys(pe.value)),q=y(()=>{const a=X.value;return{keepValue:!0,label:e.label,...a?{rules:a}:{},...e.formFieldProps}});function Ce(a){var re,le;const R=a.componentField.modelValue,B=a.componentField["onUpdate:modelValue"],O=e.modelPropName||(K(e.component)?(re=t.value)==null?void 0:re[e.component]:null);let ee=R;return R&&ye(R)&&O&&(ee=Ae(R)?(le=R==null?void 0:R.target)==null?void 0:le[O]:(R==null?void 0:R[O])??R),O?{[`onUpdate:${O}`]:B,[O]:ee===void 0?e.emptyStateValue:ee,onChange:e.disabledOnChangeListener?void 0:j=>{var ke,Me;const te=Ae(j),ne=(ke=a==null?void 0:a.componentField)==null?void 0:ke.onChange;return te?ne==null?void 0:ne(((Me=j==null?void 0:j.target)==null?void 0:Me[O])??j):ne==null?void 0:ne(j)},...e.disabledOnInputListener?{onInput:void 0}:{}}:{...e.disabledOnInputListener?{onInput:void 0}:{},...e.disabledOnChangeListener?{onChange:void 0}:{}}}function ae(a){const R=Ce(a);return{...a.componentField,...L.value,...R,...Reflect.has(L.value,"onChange")?{onChange:L.value.onChange}:{},...Reflect.has(L.value,"onInput")?{onInput:L.value.onInput}:{}}}function Fe(){var a,R;o.value&&M(o.value.focus)&&document.activeElement!==o.value&&((R=(a=o.value)==null?void 0:a.focus)==null||R.call(a))}return(a,R)=>u(b)?(w(),_(u(Mt),I({key:0},q.value,{name:a.fieldName}),{default:C(B=>[lt(U(u(_t),I({class:[{"form-valid-error":m.value,"flex-col":u(s),"flex-row items-center":!u(s),"pb-6":!u(d),"pb-2":u(d)},"flex"]},a.$attrs),{default:C(()=>[a.hideLabel?k("",!0):(w(),_(Gt,{key:0,class:Z(u(A)("flex leading-6",{"mr-2 flex-shrink-0 justify-end":!u(s),"mb-1 flex-row":u(s)},a.labelClass)),help:a.help,required:$.value&&!a.hideRequiredMark,style:Le(D.value)},{default:C(()=>[a.label?(w(),x(be,{key:0},[me("span",null,J(a.label),1),a.colon?(w(),x("span",Qt,":")):k("",!0)],64)):k("",!0)]),_:1},8,["class","help","required","style"])),me("div",{class:Z(u(A)("relative flex w-full items-center",a.wrapperClass))},[U(u(Bt),{class:Z(u(A)(a.controlClass))},{default:C(()=>[V(a.$slots,"default",H(W({...B,...ae(B),disabled:fe.value,isInValid:m.value})),()=>[(w(),_(ce(h.value),I({ref_key:"fieldComponentRef",ref:o,class:{"border-destructive focus:border-destructive hover:border-destructive/80 focus:shadow-[0_0_0_2px_rgba(255,38,5,0.06)]":m.value}},ae(B),{disabled:fe.value}),Ze({_:2},[_e(we.value,O=>({name:O,fn:C(()=>[U(Re,I({content:pe.value[O]},B),null,16,["content"])])}))]),1040,["class","disabled"]))])]),_:2},1032,["class"]),a.suffix?(w(),x("div",Jt,[U(Re,{content:a.suffix},null,8,["content"])])):k("",!0),a.description?(w(),_(u($t),{key:1},{default:C(()=>[U(Re,{content:a.description},null,8,["content"])]),_:1})):k("",!0),U(it,{name:"slide-up"},{default:C(()=>[U(u(kt),{class:"absolute -bottom-[22px]"})]),_:1})],2)]),_:2},1040,["class"]),[[ut,u(N)]])]),_:3},16,["name"])):k("",!0)}});function en(e){const t=je("wrapperRef"),n=z({}),s=z(!1),r=ct(dt),l=y(()=>{const o=e.collapsedRows??1,i=n.value;let d=0;for(let m=1;m<=o;m++)d+=(i==null?void 0:i[m])??0;return d-1||1});oe([()=>e.showCollapseButton,()=>r.active().value,()=>{var o;return(o=e.schema)==null?void 0:o.length}],async([o])=>{o&&(await ge(),n.value={},s.value=!1,await c())});async function c(){if(!e.showCollapseButton||(await ge(),!t.value))return;const o=[...t.value.children],i=t.value,m=window.getComputedStyle(i).getPropertyValue("grid-template-rows").split(" "),h=i==null?void 0:i.getBoundingClientRect();o.forEach(v=>{const p=v.getBoundingClientRect().top-h.top;let b=0,g=0;for(const[N,D]of m.entries())if(g+=Number.parseFloat(D),p<g){b=N+1;break}b>((e==null?void 0:e.collapsedRows)??1)||(n.value[b]=(n.value[b]??0)+1,s.value=!0)})}return xe(()=>{c()}),{isCalculated:s,keepFormItemIndex:l,wrapperRef:t}}const tn=T({__name:"form",props:{collapsed:{type:Boolean},collapsedRows:{default:1},collapseTriggerResize:{type:Boolean},commonConfig:{default:()=>({})},compact:{type:Boolean},componentBindEventMap:{},componentMap:{},form:{},layout:{},schema:{},showCollapseButton:{type:Boolean,default:!1},wrapperClass:{default:"grid-cols-1 sm:grid-cols-2 md:grid-cols-3"},globalCommonConfig:{default:()=>({})}},emits:["submit"],setup(e,{emit:t}){const n=e,s=t;Ht(n);const{isCalculated:r,keepFormItemIndex:l,wrapperRef:c}=en(n),o=y(()=>{var f;const v=[];return(f=n.schema)==null||f.forEach(p=>{const{fieldName:b}=p,g=p.rules;let N="";g&&!K(g)&&(N=g._def.typeName);const D=Oe(g);v.push({default:Pe(g),fieldName:b,required:!["ZodNullable","ZodOptional"].includes(N),rules:D})}),v}),i=y(()=>n.form?"form":Nt),d=y(()=>n.form?{onSubmit:n.form.handleSubmit(v=>s("submit",v))}:{onSubmit:v=>s("submit",v)}),m=y(()=>n.collapsed&&r.value),h=y(()=>{const{colon:v=!1,componentProps:f={},controlClass:p="",disabled:b,disabledOnChangeListener:g=!0,disabledOnInputListener:N=!0,emptyStateValue:D=void 0,formFieldProps:S={},formItemClass:G="",hideLabel:$=!1,hideRequiredMark:X=!1,labelClass:L="",labelWidth:fe=100,modelPropName:pe="",wrapperClass:we=""}=he(n.commonConfig,n.globalCommonConfig);return(n.schema||[]).map((q,Ce)=>{const ae=l.value,Fe=n.showCollapseButton&&m.value&&ae?ae<=Ce:!1;return{colon:v,disabled:b,disabledOnChangeListener:g,disabledOnInputListener:N,emptyStateValue:D,hideLabel:$,hideRequiredMark:X,labelWidth:fe,modelPropName:pe,wrapperClass:we,...q,commonComponentProps:f,componentProps:q.componentProps,controlClass:A(p,q.controlClass),formFieldProps:{...S,...q.formFieldProps},formItemClass:A("flex-shrink-0",{hidden:Fe},G,q.formItemClass),labelClass:A(L,q.labelClass)}})});return(v,f)=>(w(),_(ce(i.value),H(W(d.value)),{default:C(()=>[me("div",{ref_key:"wrapperRef",ref:c,class:Z([v.wrapperClass,"grid"])},[(w(!0),x(be,null,_e(h.value,p=>(w(),_(Xt,I({key:p.fieldName,ref_for:!0},p,{class:p.formItemClass,rules:p.rules}),{default:C(b=>[V(v.$slots,p.fieldName,I({ref_for:!0},b))]),_:2},1040,["class","rules"]))),128)),V(v.$slots,"default",{shapes:o.value})],2)]),_:3},16))}}),nn=T({__name:"kpu-use-form",props:{formApi:{},actionButtonsReverse:{type:Boolean},actionWrapperClass:{},fieldMappingTime:{},handleReset:{type:Function},handleSubmit:{type:Function},handleValuesChange:{type:Function},resetButtonOptions:{},showDefaultActions:{type:Boolean},submitButtonOptions:{},submitOnChange:{type:Boolean},submitOnEnter:{type:Boolean},collapsed:{type:Boolean},collapsedRows:{},collapseTriggerResize:{type:Boolean},commonConfig:{},compact:{type:Boolean},layout:{},schema:{},showCollapseButton:{type:Boolean},wrapperClass:{}},setup(e){var d,m,h,v;const t=e,n=(m=(d=t.formApi)==null?void 0:d.useStore)==null?void 0:m.call(d),s=mt(t,n),{delegatedSlots:r,form:l}=Ut(s);qt([s,l]),(v=(h=t.formApi)==null?void 0:h.mount)==null||v.call(h,l);function c(f){var p;(p=t.formApi)==null||p.setState({collapsed:!!f})}function o(f){var p;!n.value.submitOnEnter||!((p=s.value.formApi)!=null&&p.isMounted)||f.target instanceof HTMLTextAreaElement||(f.preventDefault(),s.value.formApi.validateAndSubmitForm())}const i=ft(async()=>{var f,p,b;(p=(f=s.value).handleValuesChange)==null||p.call(f,pt(await s.value.formApi.getValues())),n.value.submitOnChange&&((b=s.value.formApi)==null||b.validateAndSubmitForm())},300);return xe(async()=>{await ge(),oe(()=>l.values,i,{deep:!0})}),(f,p)=>(w(),_(u(tn),I(u(s),{collapsed:u(n).collapsed,"component-bind-event-map":u(Ve),"component-map":u(de),form:u(l),"global-common-config":u(Ue),onKeydown:ht(o,["enter"])}),Ze({default:C(b=>[V(f.$slots,"default",H(W(b)),()=>[u(s).showDefaultActions?(w(),_(zt,{key:0,"model-value":u(n).collapsed,"onUpdate:modelValue":c},{"reset-before":C(g=>[V(f.$slots,"reset-before",H(W(g)))]),"submit-before":C(g=>[V(f.$slots,"submit-before",H(W(g)))]),"expand-before":C(g=>[V(f.$slots,"expand-before",H(W(g)))]),"expand-after":C(g=>[V(f.$slots,"expand-after",H(W(g)))]),_:3},8,["model-value"])):k("",!0)])]),_:2},[_e(u(r),b=>({name:b,fn:C(g=>[V(f.$slots,b,H(W(g)))])}))]),1040,["collapsed","component-bind-event-map","component-map","form","global-common-config"]))}});function sn(e){const t=vt(e),n=new Lt(e),s=n;s.useStore=l=>bt(n.store,l);const r=T((l,{attrs:c,slots:o})=>(gt(()=>{n.unmount()}),n.setState({...l,...c}),()=>ve(nn,{...l,...c,formApi:s},o)),{inheritAttrs:!1,name:"KpuUseForm"});return t&&oe(()=>e.schema,()=>{n.setState({schema:e.schema})},{immediate:!0}),[r,s]}Dt({config:{modelPropNameMap:{Upload:"fileList",CheckboxGroup:"model-value"}},defineRules:{required:(e,t,n)=>e==null||e.length===0?Ee("ui.formRules.required",[n.label]):!0,selectRequired:(e,t,n)=>e==null?Ee("ui.formRules.selectRequired",[n.label]):!0}});const mn=sn;export{Et as S,mn as u};
