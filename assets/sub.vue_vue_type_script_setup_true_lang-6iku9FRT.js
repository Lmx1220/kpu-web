
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as N,a8 as M,aF as S,G as h,e as T,o,f,h as x,j as r,M as g,T as O,a2 as P,a_ as F,w as k,ag as J,K as W,i as $,O as p,X as b,N as v,at as j,P as w,a3 as L}from"./index-BVRkYg_n.js";import{r as V,I as z}from"./item-DLyui6DF.js";const A={class:"columns-3 p-4 2xl:columns-4"},X=N({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(q){const t=q,m=t.menu.path??JSON.stringify(t.menu),y=M(),a=M(),n=S(V),R=h(()=>n.openedMenus.includes(t.uniqueKey.at(-1))),B=h(()=>({enter(e){e.offsetHeight>window.innerHeight&&(e.style.height=`${window.innerHeight}px`)},afterEnter:()=>{},beforeLeave:e=>{e.style.overflow="hidden",e.style.maxHeight=`${e.offsetHeight}px`},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.overflow="",e.style.maxHeight=""}})),H=h(()=>({enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"})),d=h(()=>{let e=!0;return t.menu.children?t.menu.children.every(u=>{var s;return((s=u.meta)==null?void 0:s.menu)===!1})&&(e=!1):e=!1,e});function E(){d.value&&n.handleMenuItemClick(m)}let i;function K(){t.level===0&&(n.mouseInMenu=t.uniqueKey,i==null||i(),{stop:i}=w(()=>{if(d.value)n.openMenu(m,t.uniqueKey),L(()=>{const e=y.value.ref;let u=0,s=0;n.props.mode==="vertical"||t.level!==0?(u=e.getBoundingClientRect().top+e.scrollTop,s=(n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)+e.getBoundingClientRect().width,u+a.value.getElement().offsetHeight>window.innerHeight&&(u=window.innerHeight-a.value.getElement().offsetHeight)):(u=e.getBoundingClientRect().top+e.getBoundingClientRect().height,s=n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right,u+a.value.getElement().offsetHeight>window.innerHeight&&(a.value.getElement().style.height=`${window.innerHeight-u}px`)),s+a.value.getElement().offsetWidth>document.documentElement.clientWidth&&(s=(n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)-e.getBoundingClientRect().width),a.value.getElement().style.top=`${u}px`,a.value.getElement().style.insetInlineStart=`${s}px`});else{const e=t.menu.children?n.subMenus[m].indexPath.at(-1):n.items[m].indexPath.at(-1);n.openMenu(e,n.subMenus[e].indexPath)}},300))}function C(){t.level===0&&(n.mouseInMenu=[],i==null||i(),{stop:i}=w(()=>{n.mouseInMenu.length===0?n.closeMenu(t.uniqueKey):d.value&&!n.mouseInMenu.includes(t.uniqueKey.at(-1))&&n.closeMenu(t.uniqueKey.at(-1))},300))}function I(){i==null||i()}return(e,u)=>{const s=T("SubMenu");return o(),f(p,null,[x(z,{ref_key:"itemRef",ref:y,"unique-key":e.uniqueKey,item:e.menu,level:e.level,"sub-menu":r(d),onClick:E,onMouseenter:K,onMouseleave:C},null,8,["unique-key","item","level","sub-menu"]),r(d)?(o(),g(j,{key:0,to:"body",disabled:e.level!==0},[e.level===0?(o(),g(O,P({key:0},r(H),F(r(B))),{default:k(()=>[r(R)?(o(),g(r(J),{key:0,ref_key:"subMenuRef",ref:a,options:{scrollbars:{visibility:"hidden"}},defer:"",class:W(["sub-menu",{"bg-[var(--g-sub-sidebar-bg)]":e.level===0,"ring-1 ring-stone-2 dark-ring-stone-8 shadow-xl fixed z-3000":e.level===0,"rounded-2 py-1":r(n).props.rounded&&e.level===0}]),onMouseenter:I,onMouseleave:C},{default:k(()=>[$("div",A,[(o(!0),f(p,null,b(e.menu.children,l=>{var c;return o(),f("div",{key:l.path??JSON.stringify(l),class:"w-[200px] break-inside-avoid"},[((c=l.meta)==null?void 0:c.menu)!==!1?(o(),g(s,{key:0,"unique-key":[...e.uniqueKey,l.path??JSON.stringify(l)],menu:l,level:e.level+1},null,8,["unique-key","menu","level"])):v("",!0)])}),128))])]),_:1},8,["class"])):v("",!0)]),_:1},16)):(o(!0),f(p,{key:1},b(e.menu.children,l=>{var c;return o(),f(p,{key:l.path??JSON.stringify(l)},[((c=l.meta)==null?void 0:c.menu)!==!1?(o(),g(s,{key:0,"unique-key":[...e.uniqueKey,l.path??JSON.stringify(l)],menu:l,level:e.level+1},null,8,["unique-key","menu","level"])):v("",!0)],64)}),128))],8,["disabled"])):v("",!0)],64)}}});export{X as _};
