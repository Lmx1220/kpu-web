
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as K,az as C,ac as I,y as c,I as S,o as p,c as f,h as m,b as t,e as w,w as b,D as T,G as F,aH as $,n as _,F as g,U as L,f as H,S as N,aY as O,T as z,aw as A,H as x,aK as W}from"./index-D_P7dC0L.js";import{I as J,r as j}from"./item-1UG0txnI.js";const G=K({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(k){const s=k,d=s.menu.path??JSON.stringify(s.menu),h=C(),l=C(),n=I(j),y=c(()=>n.openedMenus.includes(s.uniqueKey.at(-1))),v=c(()=>n.alwaysOpenedsMenus.includes(s.uniqueKey.at(-1))),q=c(()=>n.isMenuPopup?{enter(e){e.offsetHeight>window.innerHeight&&(e.style.height=`${window.innerHeight}px`)},afterEnter:()=>{},beforeLeave:e=>{e.style.overflow="hidden",e.style.maxHeight=`${e.offsetHeight}px`},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.overflow="",e.style.maxHeight=""}}:{enter(e){const i=e.offsetHeight;e.style.maxHeight="0",e.style.overflow="hidden",e.offsetHeight,e.style.maxHeight=`${i}px`},afterEnter(e){e.style.overflow="",e.style.maxHeight=""},beforeLeave(e){e.style.overflow="hidden",e.style.maxHeight=`${e.offsetHeight}px`},leave(e){e.style.maxHeight="0"},afterLeave(e){e.style.overflow="",e.style.maxHeight=""}}),P=c(()=>n.isMenuPopup?{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"}:{enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-y-4 scale-95 blur-4",enterToClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100 translate-y-0 scale-100 blur-0",leaveToClass:"opacity-0 translate-y-4 scale-95 blur-4"}),o=c(()=>{let e=!0;return s.menu.children?s.menu.children.every(i=>{var a;return((a=i.meta)==null?void 0:a.menu)===!1})&&(e=!1):e=!1,e});function R(){v.value||n.isMenuPopup&&o.value||(o.value?n.handleSubMenuClick(d,s.uniqueKey):n.handleMenuItemClick(d))}let u;function E(){n.isMenuPopup&&(n.mouseInMenu=s.uniqueKey,u==null||u(),{stop:u}=x(()=>{if(o.value)n.openMenu(d,s.uniqueKey),W(()=>{const e=h.value.ref;let i=0,a=0;n.props.mode==="vertical"||s.level!==0?(i=e.getBoundingClientRect().top+e.scrollTop,a=(n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)+e.getBoundingClientRect().width,i+l.value.getElement().offsetHeight>window.innerHeight&&(i=window.innerHeight-l.value.getElement().offsetHeight)):(i=e.getBoundingClientRect().top+e.getBoundingClientRect().height,a=n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right,i+l.value.getElement().offsetHeight>window.innerHeight&&(l.value.getElement().style.height=`${window.innerHeight-i}px`)),a+l.value.getElement().offsetWidth>document.documentElement.clientWidth&&(a=e.getBoundingClientRect().left-e.getBoundingClientRect().width),l.value.getElement().style.top=`${i}px`,l.value.getElement().style.insetInlineStart=`${a}px`});else{const e=s.menu.children?n.subMenus[d].indexPath.at(-1):n.items[d].indexPath.at(-1);n.openMenu(e,n.subMenus[e].indexPath)}},300))}function B(){n.isMenuPopup&&(n.mouseInMenu=[],u==null||u(),{stop:u}=x(()=>{n.mouseInMenu.length===0?n.closeMenu(s.uniqueKey):o.value&&!n.mouseInMenu.includes(s.uniqueKey.at(-1))&&n.closeMenu(s.uniqueKey.at(-1))},300))}return(e,i)=>{const a=S("SubMenu");return p(),f(g,null,[m(J,{ref_key:"itemRef",ref:h,"unique-key":e.uniqueKey,item:e.menu,level:e.level,"sub-menu":t(o),expand:t(y),"always-expand":t(v),onClick:R,onMouseenter:E,onMouseleave:B},null,8,["unique-key","item","level","sub-menu","expand","always-expand"]),t(o)?(p(),w(A,{key:0,to:"body",disabled:!t(n).isMenuPopup},[m(z,N(t(P),O(t(q))),{default:b(()=>[T(m(t($),{ref_key:"subMenuRef",ref:l,options:{scrollbars:{visibility:"hidden"}},defer:"",class:_(["sub-menu",{"bg-[var(--g-sub-sidebar-bg)]":t(n).isMenuPopup,"ring-1 ring-stone-2 dark-ring-stone-8 shadow-xl fixed z-3000 w-[200px]":t(n).isMenuPopup,"mx-1":t(n).isMenuPopup&&(t(n).props.mode==="vertical"||e.level!==0),"py-1":t(n).isMenuPopup,"rounded-lg":t(n).props.rounded}])},{default:b(()=>[(p(!0),f(g,null,L(e.menu.children,r=>{var M;return p(),f(g,{key:r.path??JSON.stringify(r)},[((M=r.meta)==null?void 0:M.menu)!==!1?(p(),w(a,{key:0,"unique-key":[...e.uniqueKey,r.path??JSON.stringify(r)],menu:r,level:e.level+1},null,8,["unique-key","menu","level"])):H("",!0)],64)}),128))]),_:1},8,["class"]),[[F,t(y)]])]),_:1},16)],8,["disabled"])):H("",!0)],64)}}});export{G as _};
