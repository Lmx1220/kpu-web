
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as E,aZ as b,aD as N,c as h,L as _,o,b as c,j as w,f,h as g,T as $,Z as F,bu as J,w as k,H as O,I as W,e as L,F as p,m as R,aT as P,i as y,K as q,aU as j,aw as A}from"./index-putfknEa.js";import{I as V,r as D}from"./item-AaFN5m2P.js";const Z={class:"columns-3 p-2 px-3 2xl:columns-4"},G=E({name:"SubMenu",__name:"sub",props:{uniqueKey:{},menu:{},level:{default:0}},setup(H){const i=H,m=i.menu.path??JSON.stringify(i.menu),v=b("itemRef"),M=b("subMenuRef"),n=N(D),B=h(()=>n.openedMenus.includes(i.uniqueKey.at(-1))),K=h(()=>({enter(e){e.offsetHeight>window.innerHeight&&(e.style.height=`${window.innerHeight}px`)},afterEnter:()=>{},beforeLeave:e=>{e.style.overflow="hidden",e.style.maxHeight=`${e.offsetHeight}px`},leave:e=>{e.style.maxHeight="0"},afterLeave(e){e.style.overflow="",e.style.maxHeight=""}})),x=h(()=>({enterActiveClass:"ease-in-out duration-300",enterFromClass:"opacity-0 translate-x-4",enterToClass:"opacity-100",leaveActiveClass:"ease-in-out duration-300",leaveFromClass:"opacity-100",leaveToClass:"opacity-0"})),d=h(()=>{let e=!0;return i.menu.children?i.menu.children.every(l=>{var s;return((s=l.meta)==null?void 0:s.menu)===!1})&&(e=!1):e=!1,e});function S(){d.value&&n.handleMenuItemClick(m)}let u;function I(){i.level===0&&(n.mouseInMenu=i.uniqueKey,u==null||u(),{stop:u}=q(()=>{if(d.value)n.openMenu(m,i.uniqueKey),A(()=>{var t,a;const e=(t=v.value)==null?void 0:t.ref,l=(a=M.value)==null?void 0:a.$el;if(!e||!l)return;let s=0,r=0;n.props.mode==="vertical"||i.level!==0?(s=e.getBoundingClientRect().top+e.scrollTop,r=(n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)+e.getBoundingClientRect().width,s+l.offsetHeight>window.innerHeight&&(s=window.innerHeight-l.offsetHeight)):(s=e.getBoundingClientRect().top+e.getBoundingClientRect().height,r=n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right,s+l.offsetHeight>window.innerHeight&&(l.style.height=`${window.innerHeight-s}px`)),r+l.offsetWidth>document.documentElement.clientWidth&&(r=(n.props.direction==="ltr"?e.getBoundingClientRect().left:document.documentElement.clientWidth-e.getBoundingClientRect().right)-e.getBoundingClientRect().width),l.style.top=`${s}px`,l.style.insetInlineStart=`${r}px`});else{const e=i.menu.children?n.subMenus[m].indexPath.at(-1):n.items[m].indexPath.at(-1);n.openMenu(e,n.subMenus[e].indexPath)}},300))}function C(){i.level===0&&(n.mouseInMenu=[],u==null||u(),{stop:u}=q(()=>{n.mouseInMenu.length===0?n.closeMenu(i.uniqueKey):d.value&&!n.mouseInMenu.includes(i.uniqueKey.at(-1))&&n.closeMenu(i.uniqueKey.at(-1))},300))}function T(){u==null||u()}return(e,l)=>{const s=_("SubMenu"),r=j;return o(),c(p,null,[w(V,{ref_key:"itemRef",ref:v,"unique-key":e.uniqueKey,item:e.menu,level:e.level,"sub-menu":f(d),onClick:S,onMouseenter:I,onMouseleave:C},null,8,["unique-key","item","level","sub-menu"]),f(d)?(o(),g(P,{key:0,to:"body",disabled:e.level!==0},[e.level===0?(o(),g($,F({key:0},f(x),J(f(K))),{default:k(()=>[O(w(r,{ref_key:"subMenuRef",ref:M,mask:"",class:"sub-menu z-3000 w-150 border rounded-lg bg-[var(--g-sub-sidebar-bg)] shadow-xl fixed! 2xl:w-200",onMouseenter:T,onMouseleave:C},{default:k(()=>[L("div",Z,[(o(!0),c(p,null,R(e.menu.children,t=>{var a;return o(),c("div",{key:t.path??JSON.stringify(t),class:"w-full break-inside-avoid"},[((a=t.meta)==null?void 0:a.menu)!==!1?(o(),g(s,{key:0,"unique-key":[...e.uniqueKey,t.path??JSON.stringify(t)],menu:t,level:e.level+1},null,8,["unique-key","menu","level"])):y("",!0)])}),128))])]),_:1},512),[[W,f(B)]])]),_:1},16)):(o(!0),c(p,{key:1},R(e.menu.children,t=>{var a;return o(),c(p,{key:t.path??JSON.stringify(t)},[((a=t.meta)==null?void 0:a.menu)!==!1?(o(),g(s,{key:0,"unique-key":[...e.uniqueKey,t.path??JSON.stringify(t)],menu:t,level:e.level+1},null,8,["unique-key","menu","level"])):y("",!0)],64)}),128))],8,["disabled"])):y("",!0)],64)}}});export{G as _};
