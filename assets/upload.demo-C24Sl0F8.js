
/**
 * 由 admin 提供技术支持
 * Powered by admin
 * 代码仓库
 * Github https://github.com/Lmx1220/kpu-web
 */
    
import{d as N,I as f,o as h,e as O,w as m,c as y,a as r,h as s,f as M,q as H,N as k,_ as L,k as F,ak as T,al as X,r as j,F as Z,U as J,C as V,D as C,G as z,n as P,b as w,Z as R,M as K,P as q}from"./index-DI_iSbuB.js";import{_ as Q}from"./index-C9iCjtIj.js";import{_ as W}from"./index.vue_vue_type_script_setup_true_lang-DN1ItRwK.js";const Y={class:"slot"},x={key:0,class:"el-upload__tip"},ee={style:{display:"inline-block"}},te=N({name:"FileUpload",__name:"index",props:{action:{},headers:{},data:{},name:{default:"file"},size:{default:2},max:{default:3},files:{default:()=>[]},notip:{type:Boolean,default:!1},ext:{default:()=>["zip","rar"]},httpRequest:{}},emits:["onSuccess"],setup(E,{emit:g}){const u=E,b=g,a=t=>{const p=t.name.split(".").at(-1)??"",i=u.ext.includes(p),o=t.size/1024/1024<u.size;return i||k.error(`上传文件只支持 ${u.ext.join(" / ")} 格式！`),o||k.error(`上传文件大小不能超过 ${u.size}MB！`),i&&o},n=()=>{k.warning("文件上传超过限制")},U=(t,l,p)=>{b("onSuccess",t,l,p)},I=t=>{(p=>new Promise(i=>{const o=new XMLHttpRequest;o.open("GET",p,!0),o.responseType="blob",o.onload=()=>{o.status===200&&i(o.response)},o.send()}))(t.url).then(p=>{const i=document.createElement("a"),o=window.URL.createObjectURL(p),e=new MouseEvent("click");i.target="_blank",i.download=t.name,i.href=o,i.dispatchEvent(e)})};return(t,l)=>{const p=L,i=f("ElAlert"),o=f("ElUpload");return h(),O(o,{headers:t.headers,action:t.action,data:t.data,name:t.name,"before-upload":a,"on-exceed":n,"on-success":U,"on-preview":I,"http-request":t.httpRequest,"file-list":t.files,limit:t.max,drag:""},{tip:m(()=>[t.notip?M("",!0):(h(),y("div",x,[r("div",ee,[s(i,{title:`上传文件支持 ${t.ext.join(" / ")} 格式，单个文件大小不超过 ${t.size}MB，且文件数量不超过 ${t.max} 个`,type:"info","show-icon":"",closable:!1},null,8,["title"])])]))]),default:m(()=>[r("div",Y,[s(p,{name:"i-ep:upload-filled",class:"el-icon--upload"}),l[0]||(l[0]=r("div",{class:"el-upload__text"},[H(" 将文件拖到此处，或"),r("em",null,"点击上传")],-1))])]),_:1},8,["headers","action","data","name","http-request","file-list","limit"])}}}),se=F(te,[["__scopeId","data-v-8eb44302"]]),oe={class:"upload-container"},ae={class:"mask"},le={class:"actions"},ne=["onClick"],ie=["onClick"],pe=["onClick"],ce=["onClick"],re={key:0,class:"el-upload__tip"},ue={style:{display:"inline-block"}},de=N({name:"ImagesUpload",__name:"index",props:T({action:{},headers:{},data:{},name:{default:"file"},size:{default:2},max:{default:3},width:{default:150},height:{default:150},placeholder:{default:""},notip:{type:Boolean,default:!1},ext:{default:()=>["jpg","png","gif","bmp"]}},{modelValue:{default:[]},modelModifiers:{}}),emits:T(["onSuccess"],["update:modelValue"]),setup(E,{emit:g}){const u=E,b=g,a=X(E,"modelValue"),n=j({dialogImageIndex:0,imageViewerVisible:!1,progress:{preview:"",percent:0}});function U(e){n.value.dialogImageIndex=e,n.value.imageViewerVisible=!0}function I(){n.value.imageViewerVisible=!1}function t(e){a.value.splice(e,1)}function l(e,$){$==="left"&&e!==0&&(a.value[e]=a.value.splice(e-1,1,a.value[e])[0]),$==="right"&&e!==a.value.length-1&&(a.value[e]=a.value.splice(e+1,1,a.value[e])[0])}const p=e=>{const _=e.name.split(".").at(-1)??"",d=u.ext.includes(_),c=e.size/1024/1024<u.size;return d||k.error(`上传图片只支持 ${u.ext.join(" / ")} 格式！`),c||k.error(`上传图片大小不能超过 ${u.size}MB！`),d&&c&&(n.value.progress.preview=URL.createObjectURL(e)),d&&c},i=e=>{n.value.progress.percent=~~e.percent},o=e=>{n.value.progress.preview="",n.value.progress.percent=0,b("onSuccess",e)};return(e,$)=>{const _=f("ElImage"),d=L,c=f("ElProgress"),S=f("ElUpload"),A=f("ElAlert"),D=f("ElImageViewer");return h(),y("div",oe,[(h(!0),y(Z,null,J(a.value,(G,v)=>(h(),y("div",{key:v,class:"images"},[v<e.max?(h(),O(_,{key:0,src:G,style:V(`width:${e.width}px;height:${e.height}px;`),fit:"cover"},null,8,["src","style"])):M("",!0),r("div",ae,[r("div",le,[r("span",{title:"预览",onClick:B=>U(v)},[s(d,{name:"i-ep:zoom-in",class:"icon"})],8,ne),r("span",{title:"移除",onClick:B=>t(v)},[s(d,{name:"i-ep:delete",class:"icon"})],8,ie),C(r("span",{title:"左移",class:P({disabled:v===0}),onClick:B=>l(v,"left")},[s(d,{name:"i-ep:back",class:"icon"})],10,pe),[[z,a.value.length>1]]),C(r("span",{title:"右移",class:P({disabled:v===a.value.length-1}),onClick:B=>l(v,"right")},[s(d,{name:"i-ep:right",class:"icon"})],10,ce),[[z,a.value.length>1]])])])]))),128)),C(s(S,{"show-file-list":!1,headers:e.headers,action:e.action,data:e.data,name:e.name,"before-upload":p,"on-progress":i,"on-success":o,drag:"",class:"images-upload"},{default:m(()=>[r("div",{class:"image-slot",style:V(`width:${e.width}px;height:${e.height}px;`)},[s(d,{name:"i-ep:plus",class:"icon"})],4),C(r("div",{class:"progress",style:V(`width:${e.width}px;height:${e.height}px;`)},[s(_,{src:w(n).progress.preview,style:V(`width:${e.width}px;height:${e.height}px;`),fit:"fill"},null,8,["src","style"]),s(c,{type:"circle",width:Math.min(e.width,e.height)*.8,percentage:w(n).progress.percent},null,8,["width","percentage"])],4),[[z,w(n).progress.percent]])]),_:1},8,["headers","action","data","name"]),[[z,a.value.length<e.max]]),e.notip?M("",!0):(h(),y("div",re,[r("div",ue,[s(A,{title:`上传图片支持 ${e.ext.join(" / ")} 格式，单张图片大小不超过 ${e.size}MB，建议图片尺寸为 ${e.width}*${e.height}，且图片数量不超过 ${e.max} 张`,type:"info","show-icon":"",closable:!1},null,8,["title"])])])),w(n).imageViewerVisible?(h(),O(D,{key:1,"url-list":a.value,"initial-index":w(n).dialogImageIndex,teleported:"",onClose:I},null,8,["url-list","initial-index"])):M("",!0)])}}}),me=F(de,[["__scopeId","data-v-99ce834d"]]),he=N({name:"ComponentExampleUpload",__name:"upload.demo",setup(E){const g=j("https://picsum.photos/750/450"),u=j(["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]),b=j([{name:"测试文件.zip",url:"http://images.lookbi.com/uploads/apply/96/d8521fc691e472eec91a170201866e7d.zip"}]);function a(t){t.error===""?g.value=t.data.path:k.warning(t.error)}function n(t){t.error===""?u.value.push(t.data.path):k.warning(t.error)}function U(t,l,p){t.error===""?b.value.push({name:l.name,url:t.error===""?t.data.path:""}):(p.pop(),k.warning(t.error))}const I=[{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]},{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]},{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]},{image:"https://picsum.photos/750/450",images:["https://picsum.photos/400","https://picsum.photos/600","https://picsum.photos/500"]}];return(t,l)=>{const p=W,i=Q,o=K,e=me,$=se,_=f("ElTableColumn"),d=f("ElTable");return h(),y("div",null,[s(p,{title:"上传"},{content:m(()=>l[2]||(l[2]=[r("p",null,"ImageUpload / ImagesUpload / FileUpload",-1),r("p",{style:{"margin-bottom":"0"}}," 由于线上演示环境开启了 Mock ，会导致上传功能报错，请在本地运行并查看演示 ",-1)])),_:1}),s(o,{title:"单图上传"},{default:m(()=>[s(i,{url:w(g),"onUpdate:url":l[0]||(l[0]=c=>R(g)?g.value=c:null),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",width:250,height:150,onOnSuccess:a},null,8,["url"])]),_:1}),s(o,{title:"多图上传（默认最多3张）"},{default:m(()=>[s(e,{modelValue:w(u),"onUpdate:modelValue":l[1]||(l[1]=c=>R(u)?u.value=c:null),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",onOnSuccess:n},null,8,["modelValue"])]),_:1}),s(o,{title:"文件上传（默认最多3个）"},{default:m(()=>[s($,{files:w(b),action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/file",onOnSuccess:U},null,8,["files"])]),_:1}),s(o,{title:"结合 el-table 使用"},{default:m(()=>[s(d,{data:I,style:{width:"100%"}},{default:m(()=>[s(_,{type:"index",width:"50",fixed:"left"}),s(_,{label:"单张图片"},{default:m(({row:c})=>[s(i,{url:c.image,"onUpdate:url":S=>c.image=S,action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",width:250,height:150,onOnSuccess:a},null,8,["url","onUpdate:url"])]),_:1}),s(_,{label:"多张图片"},{default:m(({row:c})=>[s(e,{url:c.images,"onUpdate:url":S=>c.images=S,action:"https://console-mock.apipost.cn/app/mock/project/1f50f1da-5189-4282-d3c7-c133a514c5a8/upload/image",name:"image",onOnSuccess:n},null,8,["url","onUpdate:url"])]),_:1})]),_:1})]),_:1})])}}});typeof q=="function"&&q(he);export{he as default};
